<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Biểu Đồ Nhiệt Độ và Độ Ẩm</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>

</head>
<body>

<canvas id="myChart" width: 100%;
height: auto;></canvas>

<script src="firebase.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-database.js"></script>

<script>
var  firebaseConfig = {
    apiKey: "AIzaSyBE4lHtsFEb-lfTVlbFYGocvaXbvMZeSxk",
      authDomain: "iot-2024-b0528.firebaseapp.com",
      databaseURL: "https://iot-2024-b0528-default-rtdb.firebaseio.com",
      projectId: "iot-2024-b0528",
      storageBucket: "iot-2024-b0528.appspot.com",
      messagingSenderId: "234742978332",
      appId: "1:234742978332:web:7cd14df4170a068c9d8cd9",
    };

    firebase.initializeApp(firebaseConfig);

    var db = firebase.database();

    // Lưu trữ lịch sử dữ liệu
  // Khởi tạo mảng lưu trữ lịch sử nhiệt độ và độ ẩm
  var nhietDoHistory = [];
var doAmHistory = [];

var nhietDoRef = db.ref('livingroom/temperature');
nhietDoRef.on('value', function(snapshot) {
    var nhietDoValue = snapshot.val();
    console.log("Nhiệt độ mới:", nhietDoValue);
    if (nhietDoValue !== null) {
        nhietDoHistory.push({ time: new Date().toLocaleTimeString(), value: nhietDoValue });
        updateChart(nhietDoHistory, doAmHistory); // Cập nhật biểu đồ với dữ liệu mới
    }
});

var doAmRef = db.ref('livingroom/humidity');
doAmRef.on('value', function(snapshot) {
    var doAmValue = snapshot.val();
    console.log("Độ ẩm mới:", doAmValue);
    if (doAmValue !== null) {
        doAmHistory.push({ time: new Date().toLocaleTimeString(), value: doAmValue });
        updateChart(nhietDoHistory, doAmHistory); // Cập nhật biểu đồ với dữ liệu mới
    }
});

// Biểu đồ hiện tại
var chart;

// Hàm cập nhật biểu đồ
function updateChart(nhietDoData, doAmData) {
    if (!chart) {
        chart = new Chart("myChart", {
            type: "line",
            data: {
                labels: nhietDoData.map(entry => entry.time),
                datasets: [{
                    label: 'Temperature',
                    borderColor: 'orange',
                    data: nhietDoData.map(entry => entry.value),
                    fill: false
                }, {
                    label: 'Humidity',
                    borderColor: 'blue',
                    data: doAmData.map(entry => entry.value),
                    fill: false
                }]
            },
            options: {
                scales: {
                    x: {
                        type: 'time', // Sử dụng trục hoành là thời gian
                        time: {
                            displayFormats: {
                                minute: 'h:mm:ss A' // Định dạng hiển thị thời gian
                            }
                        },
                        position: 'bottom'
                    },
                    y: {
                        beginAtZero: false, // Không bắt đầu từ 0 để dễ nhìn thấy sự thay đổi nhỏ
                        suggestedMax: 100 // Đặt giá trị tối đa cho trục tung là 100
                    }
                },
                legend: { display: true },
                title: {
                    display: true,
                    text: "Sensor Data Over Time"
                }
            }
        });
    } else {
        chart.data.labels = nhietDoData.map(entry => entry.time);
        chart.data.datasets[0].data = nhietDoData.map(entry => entry.value);
        chart.data.datasets[1].data = doAmData.map(entry => entry.value);

        chart.update();
    }
}





</script>
</body>
</html>